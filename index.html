<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Professional Ruqyah App</title>

<style>
body{
  margin:0;
  font-family:Segoe UI;
  background:linear-gradient(135deg,#0d3b2e,#145c43);
  color:white;
  text-align:center;
}
header{
  padding:20px;
  font-size:22px;
  background:#083c2a;
  color:gold;
}
button{
  padding:12px 20px;
  margin:10px;
  border:none;
  border-radius:10px;
  font-size:16px;
  cursor:pointer;
}
.play{background:gold;}
.stop{background:#b22222;color:white;}
.status{
  margin-top:15px;
  font-size:18px;
  color:#ffd700;
}
</style>
</head>
<body>

<header>üìñ Authentic Ruqyah Recitation</header>

<button class="play" onclick="start()">‚ñ∂ Start</button>
<button class="stop" onclick="stop()">‚èπ Stop</button>

<div class="status" id="status"></div>

<audio id="player"></audio>

<script>

const RECITER_ID = 7; 
// 7 = Mishary Rashid Alafasy (Quran.com official)

const audio = document.getElementById("player");

const ruqyahItems = [
  {type:"surah", number:1, name:"Surah Fatiha"},
  {type:"surah", number:112, name:"Surah Ikhlas"},
  {type:"surah", number:113, name:"Surah Falaq"},
  {type:"surah", number:114, name:"Surah Naas"},
  {type:"ayah", key:"2:255", name:"Ayat ul Kursi"},
  {type:"ayahRange", start:285, end:286, surah:2, name:"Baqarah 285-286"}
];

let index=0;
let repeat=0;
let playing=false;
let ayahUrls=[];
let ayahIndex=0;

function stop(){
  audio.pause();
  audio.currentTime=0;
  playing=false;
  document.getElementById("status").innerText="‚èπ Stopped";
}

async function start(){
  if(playing) return;
  playing=true;
  index=0;
  await playItem();
}

async function playItem(){

  if(index>=ruqyahItems.length){
    document.getElementById("status").innerText="‚úÖ Ruqyah Completed";
    playing=false;
    return;
  }

  repeat=0;
  const item=ruqyahItems[index];

  if(item.type==="surah"){
    audio.src=`https://verses.quran.com/${RECITER_ID}/${item.number}.mp3`;
    audio.play();
    document.getElementById("status").innerText=item.name+" (1/3)";
  }

  else if(item.type==="ayah"){
    const res=await fetch(`https://api.quran.com/api/v4/verses/by_key/${item.key}?audio=${RECITER_ID}`);
    const data=await res.json();
    audio.src=data.verse.audio.url;
    audio.play();
    document.getElementById("status").innerText=item.name+" (1/3)";
  }

  else if(item.type==="ayahRange"){
    ayahUrls=[];
    for(let i=item.start;i<=item.end;i++){
      const res=await fetch(`https://api.quran.com/api/v4/verses/by_key/${item.surah}:${i}?audio=${RECITER_ID}`);
      const data=await res.json();
      ayahUrls.push(data.verse.audio.url);
    }
    ayahIndex=0;
    playAyahRange(item.name);
  }
}

function playAyahRange(name){
  audio.src=ayahUrls[ayahIndex];
  audio.play();
  document.getElementById("status").innerText=
    name+" (Ayah "+(ayahIndex+1)+") ("+(repeat+1)+"/3)";
}

audio.onended=function(){
  if(!playing) return;

  const item=ruqyahItems[index];

  if(item.type==="ayahRange"){
    ayahIndex++;
    if(ayahIndex<ayahUrls.length){
      playAyahRange(item.name);
      return;
    }
  }

  repeat++;

  if(repeat<3){
    if(item.type==="ayahRange"){
      ayahIndex=0;
      playAyahRange(item.name);
    }else{
      audio.play();
      document.getElementById("status").innerText=
        item.name+" ("+(repeat+1)+"/3)";
    }
  }else{
    index++;
    playItem();
  }
};

</script>

</body>
</html>
